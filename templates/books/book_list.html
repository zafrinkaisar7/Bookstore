{% extends "base.html" %}
{% load static %}

{% block content %}
   <div class="container mt-4">
      <div class="row">
         <!-- Category Sidebar -->
         <div class="col-md-2">
            <div class="card shadow-sm">
               <div class="card-header bg-white">
                  <h5 class="mb-0">Categories</h5>
               </div>
               <div class="list-group list-group-flush">
                  <a href="{% url 'book_list' %}"
                     class="list-group-item list-group-item-action {% if not selected_category %}active{% endif %}">
                     <i class="fas fa-book me-2"></i>All Books
                  </a>
                  {% for category in categories %}
                     <a href="{% url 'book_list' %}?category={{ category.id }}"
                        class="list-group-item list-group-item-action {% if selected_category == category.id %}active{% endif %}">
                        <i class="fas fa-tag me-2"></i>{{ category.name }}
                     </a>
                  {% endfor %}
               </div>
            </div>
         </div>

         <!-- Books Grid -->
         <div class="col-md-10">
            <div class="row g-4">
               {% for book in books %}
                  <div class="col-md-3">
                     <div class="card h-100 book-card">
                        {% if book.image %}
                           <img src="{{ book.image.url }}"
                                class="card-img-top book-image"
                                alt="{{ book.title }}"
                                width="250"
                                height="350" />
                        {% else %}
                           <div class="card-img-top book-placeholder">
                              <i class="fas fa-book fa-3x text-muted"></i>
                           </div>
                        {% endif %}
                        <div class="card-body p-3">
                           <h5 class="card-title mb-2">{{ book.title|truncatewords:4 }}</h5>
                           <p class="card-text text-muted mb-2">{{ book.author|truncatechars:20 }}</p>
                           <div class="d-flex justify-content-between align-items-center mb-2">
                              <span class="badge bg-light text-dark">{{ book.category.name|default:"Uncategorized"|truncatechars:15 }}</span>
                              <span class="text-primary fw-bold">${{ book.price }}</span>
                           </div>
                           <div class="d-flex justify-content-between align-items-center">
                              {% if book.stock > 2 %}
                                 <span class="text-success">
                                    <i class="fas fa-check-circle me-1"></i>In Stock
                                 </span>
                                 <div class="btn-group">
                                    <a href="{% url 'book_detail' book.id %}" class="btn btn-outline-dark">
                                       <i class="fas fa-eye"></i>
                                    </a>
                                    {% if user.is_authenticated %}
                                       <a href="{% url 'add_to_cart' book.id %}"
                                          class="btn btn-outline-dark cart-btn">
                                          <i class="fas fa-shopping-cart"></i>
                                       </a>
                                    {% endif %}
                                 </div>
                              {% else %}
                                 <span class="text-danger">
                                    <i class="fas fa-times-circle me-1"></i>Out of Stock
                                 </span>
                                 <div class="btn-group">
                                    <button class="btn btn-outline-dark" disabled>
                                       <i class="fas fa-eye"></i>
                                    </button>
                                    <button class="btn btn-outline-dark" disabled>
                                       <i class="fas fa-shopping-cart"></i>
                                    </button>
                                 </div>
                              {% endif %}
                           </div>
                        </div>
                     </div>
                  </div>
               {% empty %}
                  <div class="col-12">
                     <div class="text-center py-5">
                        <i class="fas fa-book fa-3x text-muted mb-3"></i>
                        <p class="text-muted">No books found in this category.</p>
                     </div>
                  </div>
               {% endfor %}
            </div>
         </div>
      </div>
   </div>

   <style>
      .book-card {
         transition: all 0.3s ease;
         border: none;
         background: #fff;
         box-shadow: 0 2px 4px rgba(0,0,0,0.05);
      }
      
      .book-card:hover {
         transform: translateY(-5px);
         box-shadow: 0 8px 16px rgba(0,0,0,0.1);
      }
      
      .book-image {
         object-fit: cover;
         border-radius: 4px 4px 0 0;
      }
      
      .book-placeholder {
         height: 350px;
         background-color: #f8f9fa;
         display: flex;
         align-items: center;
         justify-content: center;
         border-radius: 4px 4px 0 0;
      }
      
      .list-group-item {
         color: #000;
         border-color: #dee2e6;
         transition: all 0.2s ease;
      }
      
      .list-group-item:hover {
         background-color: #f8f9fa;
         color: #000;
         transform: translateX(5px);
      }
      
      .list-group-item.active {
         background-color: #fff;
         color: #000;
         border-color: #000;
         font-weight: 500;
         border-left: 3px solid #000;
      }
      
      .list-group-item.active:hover {
         background-color: #fff;
         color: #000;
      }
      
      .text-success {
         color: #28a745 !important;
      }
      
      .text-danger {
         color: #dc3545 !important;
      }
      
      button:disabled {
         opacity: 0.65;
         cursor: not-allowed;
      }
      
      .card {
         font-size: 0.9rem;
         border-radius: 8px;
      }
      
      .card-title {
         font-size: 1rem;
         margin-bottom: 0.5rem;
         font-weight: 500;
      }
      
      .btn {
         padding: 0.4rem 0.6rem;
         font-size: 0.9rem;
         border-radius: 4px;
         background-color: white;
         border: 1px solid #000;
         color: #000;
         transition: all 0.2s ease;
      }

      .btn-group {
         display: flex;
         gap: 4px;
      }

      .btn-group .btn {
         border-radius: 4px;
      }

      .cart-btn {
         background-color: white;
         border: 1px solid #000;
         color: #000;
         transition: all 0.2s ease;
      }

      .cart-btn:hover {
         background-color: #f8f9fa;
         border-color: #000;
         transform: scale(1.05);
      }

      .btn-outline-dark {
         background-color: white;
         border: 1px solid #000;
         color: #000;
         transition: all 0.2s ease;
      }

      .btn-outline-dark:hover {
         background-color: #f8f9fa;
         border-color: #000;
         transform: scale(1.05);
      }

      .badge {
         font-size: 0.8rem;
         font-weight: normal;
         padding: 0.4em 0.7em;
         background-color: #f8f9fa;
         border: 1px solid #dee2e6;
      }

      .card-header {
         border-bottom: 1px solid rgba(0,0,0,0.1);
         font-weight: 500;
      }

      /* Disabled button styles */
      .btn:disabled {
         background-color: #f8f9fa;
         border-color: #dee2e6;
         color: #6c757d;
      }
   </style>
{% endblock content %}
